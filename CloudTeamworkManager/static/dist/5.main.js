(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{18:function(t,a,e){var i,s;
/*!
 * classie - class helper functions
 * from bonzo https://github.com/ded/bonzo
 * 
 * classie.has( elem, 'my-class' ) -> true/false
 * classie.add( elem, 'my-new-class' )
 * classie.remove( elem, 'my-unwanted-class' )
 * classie.toggle( elem, 'my-class' )
 */!function(o){"use strict";function n(t){return new RegExp("(^|\\s+)"+t+"(\\s+|$)")}var l,r,c;function d(t,a){(l(t,a)?c:r)(t,a)}"classList"in document.documentElement?(l=function(t,a){return t.classList.contains(a)},r=function(t,a){t.classList.add(a)},c=function(t,a){t.classList.remove(a)}):(l=function(t,a){return n(a).test(t.className)},r=function(t,a){l(t,a)||(t.className=t.className+" "+a)},c=function(t,a){t.className=t.className.replace(n(a)," ")}),void 0===(s="function"==typeof(i={hasClass:l,addClass:r,removeClass:c,toggleClass:d,has:l,add:r,remove:c,toggle:d})?i.call(a,e,a,t):i)||(t.exports=s)}(window)},20:function(t,a,e){var i=e(35);"string"==typeof i&&(i=[[t.i,i,""]]);var s={insert:"head",singleton:!1};e(3)(i,s);i.locals&&(t.exports=i.locals)},34:function(t,a,e){"use strict";var i=e(20);e.n(i).a},35:function(t,a,e){(t.exports=e(2)(!1)).push([t.i,"\n.navbar[data-v-1d1d7504] {\n    width: 100%;\n}\n.toast[data-v-1d1d7504]{\n    padding: 0px;\n}\n",""])},67:function(t,a,e){"use strict";e.r(a);var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("div",{attrs:{id:"bar"}},[e("nav",{staticClass:"navbar navbar-expand-sm navbar-light bg-light",staticStyle:{height:"4rem","z-index":"1"}},[e("div",{staticClass:"container"},[e("a",{staticClass:"navbar-brand col-3",attrs:{href:"/"},on:{click:function(a){return a.preventDefault(),t.mySwitch(["home",null])}}},[e("img",{staticClass:"rounded",attrs:{src:"/static/pic/logo2.png"}})]),t._v(" "),e("div",{staticClass:"collapse navbar-collapse container",attrs:{id:"navbarNav"}},[e("ul",{staticClass:"navbar-nav col-8 container-fluid row"},[e("li",{staticClass:"nav-item col-4"},[e("a",{staticClass:"nav-link",attrs:{href:"/space/"},on:{click:function(a){return a.preventDefault(),t.mySwitch(["space",null])}}},[t._v("个人中心")])]),t._v(" "),e("li",{staticClass:"nav-item col-4"},[e("a",{staticClass:"nav-link",attrs:{href:"/task_list/"},on:{click:function(a){return a.preventDefault(),t.mySwitch(["taskList",null])}}},[t._v("任务列表")])]),t._v(" "),e("li",{staticClass:"nav-item col-4"},[e("a",{staticClass:"nav-link",attrs:{href:"/noti/"},on:{click:function(a){return a.preventDefault(),t.mySwitch(["noti",null])}}},[t._v("消息中心")])])]),t._v(" "),e("div",{staticClass:"collapse navbar-collapse justify-content-end",attrs:{id:"navbarNav-1"}},[e("ul",{staticClass:"navbar-nav col-auto"},[e("li",{staticClass:"nav-item "},[e("a",{staticStyle:{cursor:"pointer"},on:{click:function(a){return t.show_side_bar()}}},[e("img",{attrs:{src:"/static/pic/menu.png"}})])])])])])])]),t._v(" "),e("div",{staticClass:"modal fade",attrs:{id:"sidebar"}},[e("div",{staticClass:"modal-dialog",staticStyle:{margin:"0px",position:"absolute",right:"0rem",height:"100%",width:"20rem"}},[e("div",{staticClass:"modal-content",staticStyle:{"border-radius":"0px",border:"0px",height:"100%","background-color":"rgba(255, 255, 255, 0.7)"}},[e("div",{staticClass:"modal-body",staticStyle:{padding:"0px"}},[t.globle_props.is_login?t._e():e("div",[e("div",{staticStyle:{position:"absolute",top:"30%",left:"50%",transform:"translateX(-50%)"}},[e("img",{staticStyle:{position:"relative",left:"50%",transform:"translateX(-50%)"},attrs:{src:"/static/pic/user.png"}}),t._v(" "),e("div",{staticClass:"lead",staticStyle:{color:"#333333","margin-top":".5rem"}},[t._v("您还未"),e("a",{attrs:{href:"/account/login"},on:{click:function(a){return a.preventDefault(),t.hideBarAndSwitch(["signIn",null])}}},[t._v("登录")])])])]),t._v(" "),t.globle_props.is_login?e("div",[e("div",{staticClass:"clearfix",staticStyle:{width:"80%",height:"7.5rem","margin-left":"10%","margin-top":"5%"}},[e("div",{staticStyle:{float:"left",transform:"translateY(-50%)","text-align":"center",top:"50%",position:"relative"}},[e("div",{staticStyle:{color:"#333333","font-size":"26px"}},[t._v(t._s(t.globle_props.name))]),t._v(" "),e("a",{staticStyle:{color:"#F44336","font-size":"18px"},attrs:{href:"/account/logout/"},on:{click:function(a){return a.preventDefault(),t.logout(a)}}},[t._v("退出登录")])]),t._v(" "),e("img",{staticClass:"float-right rounded-circle",staticStyle:{width:"30%",top:"50%",transform:"translateY(-50%)",position:"relative"},attrs:{src:!!t.globle_props.is_login&&"/file/avatar/"+t.globle_props.randint}})]),t._v(" "),e("div",{staticStyle:{width:"100%","margin-top":"5%"}},[0==Number(t.globle_props.unread_notifications)?e("div",{staticStyle:{"padding-left":".75rem","font-weight":"bold"}},[t._v("暂无未读消息")]):t._e(),t._v(" "),t._l(t.globle_props.unread_notifications,(function(a,i){return e("div",{key:i,staticClass:"toast fade md-trigger",staticStyle:{"box-shadow":"0px 0px 0px",border:"0px","border-radius":"0px"},attrs:{"data-modal":"modal-4","data-autohide":"false",role:"console.log","aria-live":"assertive","aria-atomic":"true"},on:{click:function(e){return t.show_detail(a.verb,a.description,a.timestamp,a.id,i)}}},[e("div",{staticClass:"toast-header",staticStyle:{"border-bottom":"0px"}},[e("strong",{staticClass:"mr-auto"},[t._v(t._s(a.verb))]),t._v(" "),e("small",{staticClass:"text-muted"},[t._v(t._s(t.timestamp_to_date(a.timestamp)))]),t._v(" "),t._m(0,!0)]),t._v(" "),e("div",{staticClass:"toast-body"},[t._v(t._s(a.description))])])}))],2),t._v(" "),e("div",{staticStyle:{position:"fixed",bottom:"1rem",width:"100%","text-align":"center"}},[0!=Number(t.globle_props.unread_notifications)?e("a",{staticStyle:{"font-size":"12px",float:"right","text-decoration":"none","margin-right":"1rem"},attrs:{href:""},on:{click:function(a){return a.preventDefault(),t.mark_all_read()}}},[t._v("标记全部为已读")]):t._e(),t._v(" "),e("a",{staticStyle:{color:"#666666","font-size":"18px",display:"block",clear:"both","text-decoration":"none"},attrs:{href:"/noti/"},on:{click:function(a){return a.preventDefault(),t.hideBarAndSwitch(["noti",null])}}},[t._v("进入消息中心")])])]):t._e()])])])]),t._v(" "),e("div",[e("div",{staticClass:"md-modal md-effect-8",attrs:{id:"modal-4"}},[e("div",{staticClass:"md-content"},[e("div",[e("div",{staticClass:"container-fluid"},[t._m(1),t._v(" "),e("div",{staticClass:"row"},[e("div",{staticClass:"col-12"},[e("div",{staticClass:"lead",staticStyle:{"letter-spacing":"2px"}},[t._v(t._s(t.detail_title))]),t._v(" "),e("div",{staticClass:"text-left",staticStyle:{"letter-spacing":"1px"}},[t._v("\n                                        "+t._s(t.detail_body)+"\n                                    ")])])]),t._v(" "),e("div",{staticClass:"row"},[e("div",{staticClass:"col-12"},[e("small",[t._v(t._s(t.timestamp_to_date(t.detail_date)))])])])])])])]),t._v(" "),e("div",{staticClass:"md-overlay"})])])])};i._withStripped=!0;var s=e(18),o=e.n(s),n={data:()=>({detail_title:"",detail_body:"",detail_date:""}),props:["globle_props"],computed:{timestamp_to_date:()=>(function(t){return(t=Date.parse(new Date)/1e3-t)<60?"不久前":t<3600?Math.round(t/60)+"分钟前":t<86400?Math.round(t/3600)+"小时前":t<2592e3?Math.round(t/86400)+"天前":"很久前"})},mounted(){this.receive_noti(),this.modalEffects()},methods:{modalEffects:function(){var t=document.querySelectorAll(".md-overlay")[0];[].slice.call(document.querySelectorAll(".md-trigger")).forEach((function(a,e){var i=document.querySelector("#"+a.getAttribute("data-modal")),s=i.querySelector(".md-close");function n(){var t;t=o.a.has(a,"md-setperspective"),o.a.remove(i,"md-show"),t&&o.a.remove(document.documentElement,"md-perspective")}a.addEventListener("click",(function(e){o.a.add(i,"md-show"),t.removeEventListener("click",n),t.addEventListener("click",n),o.a.has(a,"md-setperspective")&&setTimeout((function(){o.a.add(document.documentElement,"md-perspective")}),25)})),s.addEventListener("click",(function(t){t.stopPropagation(),n()}))}))},logout:function(){this.$http.get("/account/logout/"),this.hideBarAndSwitch(["signIn",null])},hideBarAndSwitch:function(t){$("#sidebar").modal("hide"),this.mySwitch(t)},show_side_bar:function(){$("#sidebar").modal("toggle"),$(".toast").toast("show")},mark_all_read:function(){for(var t=$(".toast"),a=t.length-1,e=0;a>=0;a--,e++)this.doSetTimeout(t.eq(1*a),e);setTimeout(()=>{$("#sidebar").modal("toggle")},150*e),setTimeout(()=>{this.globle_props.unread_notifications=[]},150*e+500),this.$http.get("/noti/mark_all_as_read/")},doSetTimeout:function(t,a){setTimeout(()=>{t.toast("hide")},150*a)},mySwitch:function(t){"signUp"==t[0]||this.globle_props.is_login?this.$emit("switch",t):this.$emit("switch",["signIn",null])},show_detail:function(t,a,e,i,s){this.detail_title=t,this.detail_body=a,this.detail_date=e,this.$http.get("/noti/mark_target_as_read/"+i),this.globle_props.read_notifications.unshift(this.globle_props.unread_notifications.splice(s,1)[0])},receive_noti:function(){var t=this;if("WebSocket"in window){console.log("您的浏览器支持 WebSocket!");var a=new WebSocket("ws://"+window.location.host+"/noti/receive_noti/");a.onopen=function(){console.log("与服务器连接成功!")},a.onmessage=function(a){var e=JSON.parse(a.data);200==e.status&&t.globle_props.unread_notifications.push(e)},a.onclose=function(){console.log("连接已断开")},window.s=a}else console.log("您的浏览器不支持 WebSocket!")}}},l=(e(34),e(5)),r=Object(l.a)(n,i,[function(){var t=this.$createElement,a=this._self._c||t;return a("button",{staticClass:"ml-2 close",attrs:{type:"button","data-dismiss":"toast","aria-label":"Close"}},[a("span",{attrs:{"aria-hidden":"true"}},[this._v("×")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"row justify-content-between"},[a("div",{staticClass:"col-4",staticStyle:{"margin-top":"10px","font-size":"24px"}},[this._v("\n                                    消息详情\n                                ")]),this._v(" "),a("div",{staticClass:"col-2",staticStyle:{"margin-top":"10px"}},[a("button",{staticClass:"md-close btn-sm btn-primary",staticStyle:{"background-color":"transparent",border:"none",height:"100%"}},[a("img",{attrs:{src:"/static/pic/close.png"}})])])])}],!1,null,"1d1d7504",null);r.options.__file="src/VueComponent/totalBar.vue";a.default=r.exports}}]);